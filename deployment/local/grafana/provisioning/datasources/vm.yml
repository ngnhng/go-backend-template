apiVersion: 1

datasources:
  # 1. TRACES (Define this FIRST so others can link to it)
  # ----------------------------------------------------
  - name: VictoriaTraces
    type: jaeger
    access: proxy
    url: http://victoria-traces:8429
    uid: victoria-traces
    basicAuth: false
    isDefault: false
    editable: true
    jsonData:
      nodeGraph:
        enabled: true
      # Link Traces -> Logs
      logs:
        datasourceUid: victoria-logs
        spanStartTimeShift: "-1h"
        spanEndTimeShift: "1h"

  # 2. LOGS (VictoriaLogs)
  # ----------------------
  - name: VictoriaLogs
    type: victoriametrics-logs-datasource
    access: proxy
    url: http://victoria-logs:9428
    uid: victoria-logs
    jsonData:
      # Link Logs -> Traces
      derivedFields:
        - datasourceUid: victoria-traces
          matcherRegex: "trace_id=(\\w+)"
          name: TraceID
          url: "$${__value.raw}"

  # 3. METRICS (VictoriaMetrics)
  # ----------------------------
  - name: VictoriaMetrics
    type: prometheus
    access: proxy
    url: http://victoria-metrics:8428
    isDefault: true
    uid: victoria-metrics
    jsonData:
      # Link Metrics -> Traces
      exemplarTraceIdDestinations:
        - datasourceUid: victoria-traces
          name: trace_id
